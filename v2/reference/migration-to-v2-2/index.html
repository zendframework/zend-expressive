<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PSR-15 Middleware in Minutes">  
    <link rel="canonical" href="https://docs.zendframework.com/zend-expressive/v2/reference/migration-to-v2-2/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    <title>To version 2.2 - Expressive - Zend Framework Docs</title>

    <link rel="stylesheet" href="../../../css/styles-5cfabd53ee.css">
        <link href="../../../css/zend-expressive.css" rel="stylesheet">
</head>
<body id="page-top">

    
    <div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">

            
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="../../../img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">

            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>

            
            
                <div class="nav navbar-nav navbar-collapse visible-xs-block ">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../../..">Expressive</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                
            

                
                
                    
                        
    <li class="subnavigation__list-item ">
        <a href="../../" class="subnavigation__link">Expressive: PSR-7 Middleware in Minutes</a>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Getting Started</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/features/" class="subnavigation__link">Overview and Features</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/standalone/" class="subnavigation__link">Quick Start: Standalone</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/skeleton/" class="subnavigation__link">Quick Start: Skeleton Installer</a>
    </li>

            
        </ul>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Features</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/middleware-types/" class="subnavigation__link">Middleware Types</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/application/" class="subnavigation__link">Applications</a>
    </li>

            
                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Containers</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/container/intro/" class="subnavigation__link">Introduction</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/container/factories/" class="subnavigation__link">Container Factories</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/container/delegator-factories/" class="subnavigation__link">Delegator Factories</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/container/zend-servicemanager/" class="subnavigation__link">Using zend-servicemanager</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/container/pimple/" class="subnavigation__link">Using Pimple</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/container/aura-di/" class="subnavigation__link">Using Aura.Di</a>
    </li>

            
        </ul>
    </li>

            
                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Routing Adapters</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/intro/" class="subnavigation__link">Introduction</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/interface/" class="subnavigation__link">Routing Interface</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/uri-generation/" class="subnavigation__link">URI Generation</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/piping/" class="subnavigation__link">Routing vs Piping</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/aura/" class="subnavigation__link">Using Aura</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/fast-route/" class="subnavigation__link">Using FastRoute</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/zf2/" class="subnavigation__link">Using the ZF2 Router</a>
    </li>

            
        </ul>
    </li>

            
                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Templating</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/template/intro/" class="subnavigation__link">Introduction</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/template/interface/" class="subnavigation__link">Template Renderer Interface</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/template/middleware/" class="subnavigation__link">Templated Middleware</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/template/plates/" class="subnavigation__link">Using Plates</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/template/twig/" class="subnavigation__link">Using Twig</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/template/zend-view/" class="subnavigation__link">Using zend-view</a>
    </li>

            
        </ul>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/error-handling/" class="subnavigation__link">Error Handling</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/modular-applications/" class="subnavigation__link">Modular Applications</a>
    </li>

            
                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Middleware</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/middleware/implicit-methods-middleware/" class="subnavigation__link">Implicit HEAD and OPTIONS Middleware</a>
    </li>

            
        </ul>
    </li>

            
                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Helpers</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/helpers/intro/" class="subnavigation__link">Introduction</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/helpers/url-helper/" class="subnavigation__link">UrlHelper</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/helpers/server-url-helper/" class="subnavigation__link">ServerUrlHelper</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/helpers/body-parse/" class="subnavigation__link">Body Parsing Middleware</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/helpers/content-length/" class="subnavigation__link">Content-Length Middleware</a>
    </li>

            
        </ul>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/emitters/" class="subnavigation__link">Emitters</a>
    </li>

            
        </ul>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Cookbook</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/autowiring-routes-and-pipelines/" class="subnavigation__link">Autowiring routes and pipeline middleware</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/common-prefix-for-routes/" class="subnavigation__link">Prepending a common path to all routes</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/route-specific-pipeline/" class="subnavigation__link">Route-specific middleware pipelines</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/using-custom-view-helpers/" class="subnavigation__link">Registering custom view helpers when using zend-view</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/using-zend-form-view-helpers/" class="subnavigation__link">Using zend-form view helpers</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/using-a-base-path/" class="subnavigation__link">Using Expressive from a subdirectory</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/setting-locale-depending-routing-parameter/" class="subnavigation__link">Setting a locale based on a routing parameter</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/setting-locale-without-routing-parameter/" class="subnavigation__link">Setting a locale without a routing parameter</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/debug-toolbars/" class="subnavigation__link">Enabling debug toolbars</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/using-routed-middleware-class-as-controller/" class="subnavigation__link">Handling multiple routes in a single class</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/flash-messengers/" class="subnavigation__link">Flash Messengers</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/passing-data-between-middleware/" class="subnavigation__link">Passing data between middleware</a>
    </li>

            
        </ul>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Reference</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../why-expressive/" class="subnavigation__link">Why choose Expressive?</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../cli-tooling/" class="subnavigation__link">CLI Tooling</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../usage-examples/" class="subnavigation__link">Examples</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../expressive-projects/" class="subnavigation__link">Expressive Projects</a>
    </li>

            
                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Migration</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../migration/" class="subnavigation__link">To version 2</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">To version 2.2</a>
    </li>

            
        </ul>
    </li>

            
        </ul>
    </li>

                    
                
            

                
                

                    
                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="nav navbar-nav navbar-collapse visible-xs-block">
                <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</div>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation

                    
                        <small class="header__subtitle">Expressive</small>
                    
                </h1>
            </div>

            
            <div class="col-xs-4 text-right">
                
                    
<div class="version-selector">
    <div class="btn-group">
        <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            
                v2
            
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            
                
                    <li class="dropdown-menu__item">
                        <a href="../../..">
                            
                                v3 (latest)
                            
                        </a>
                    </li>
                
            
                
                    <li class="dropdown-menu__item dropdown-menu__item--selected">
                        <a href="../../">
                            
                                v2
                            
                        </a>
                    </li>
                
            
                
                    <li class="dropdown-menu__item">
                        <a href="../../../v1/">
                            
                                v1
                            
                        </a>
                    </li>
                
            
        </ul>
    </div>
</div>


                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/zendframework/zend-expressive/" class="header__link header__link--github" title="Go to repository of Expressive">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="laminas-announcement">
    <div class="container">
        <div class="row">
            <div class="col-xs-12">
                Zend Framework transitions to the Linux Foundation. <a href="https://getlaminas.org">Learn More.</a>
            </div>
        </div>
    </div>
</div>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-xs-12 content" role="main">
            <!-- content:begin -->
                
                    <ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
    <li><a href="https://framework.zend.com/">Home</a></li>

    
        <li><a href="https://docs.zendframework.com/">Documentation</a></li>

        
            <li><a href="../../..">Expressive</a></li>

            
                
                    
                    
                
            
                
                    
                    
                        <li>Reference</li>
                    
                
            
                
                    
                    
                        <li>Migration</li>
                    
                
            

            <li class="active">To version 2.2</li>
        
    
</ol>



    <div class="alert alert-danger" role="alert">
        <h4>Caution</h4>
        <p>
            The documentation you are viewing is for an older version of this component.<br>
            <a href="../../..">Switch to the latest (v3) version.</a>
        </p>
    </div>




    
    
        <h2 class="chapter__headline">Migration</h2>
    

    <div>
        
    

    
    
        <div class="toc">
            <h6 class="toc__headline">In This Article</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#config-providers" class="toc__link">Config providers</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#routing-and-dispatch-middleware" class="toc__link">Routing and dispatch middleware</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#routing-and-dispatch-constants" class="toc__link">Routing and dispatch constants</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#implicit-head-and-options-middleware" class="toc__link">Implicit HEAD and OPTIONS middleware</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#response-prototypes" class="toc__link">Response prototypes</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#double-pass-middleware" class="toc__link">Double-Pass middleware</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#other-deprecations" class="toc__link">Other deprecations</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#applicationconfiginjectiondelegator" class="toc__link">ApplicationConfigInjectionDelegator</a>
                    </li>
                
            </ul>
        </div>
    

    </div>

    <h1 id="migration-to-expressive-22">Migration to Expressive 2.2</h1>
<p>Version 2.2 exists to message deprecated functionality, and to provide backports
of functionality from version 3.0 as it makes sense. In most cases, your code
should continue to work as it did before, but may now emit deprecation notices.
This document details some specific deprecations, and how you can change your
code to remove the messages, and, simultaneously, help prepare your code for
version 3.</p>
<h2 id="config-providers">Config providers</h2>
<p>The zend-expressive and zend-expressive-router packages now expose <em>config
providers</em>. These are dedicated classes that return package-specific
configuration, including dependency information. We suggest you add these to
your application's configuration. Add the following two lines in your
<code>config/config.php</code> file, inside the array passed to the <code>ConfigAggregator</code>
constructor:</p>
<pre class=codehilite><code class=language-php>\Zend\Expressive\ConfigProvider::class,
\Zend\Expressive\Router\ConfigProvider::class,</code></pre>
<blockquote>
<p>The command <code>./vendor/bin/expressive migrate:expressive-v2.2</code> will do this for
you.</p>
</blockquote>
<h2 id="routing-and-dispatch-middleware">Routing and dispatch middleware</h2>
<p>In previous releases of Expressive, you would route your routing and dispatch
middleware using the following dedicated methods:</p>
<pre class=codehilite><code class=language-php>$app-&gt;pipeRoutingMiddleware();
$app-&gt;pipeDispatchMiddleware();</code></pre>
<p>These methods are now <em>deprecated</em>, and will be removed in version 3.0.</p>
<p>Instead, you should use <code>pipe()</code> with the following services:</p>
<pre class=codehilite><code class=language-php>$app-&gt;pipe(\Zend\Expressive\Router\Middleware\RouteMiddleware::class);
$app-&gt;pipe(\Zend\Expressive\Router\Middleware\DispatchMiddleware::class);</code></pre>
<blockquote>
<p>The command <code>./vendor/bin/expressive migrate:expressive-v2.2</code> will do this for
you.</p>
</blockquote>
<p>This also means you can easily replace these middleware with your own at this
time!</p>
<h2 id="routing-and-dispatch-constants">Routing and dispatch constants</h2>
<p>If you are using configuration-driven routes, you are likely using the constants
<code>Zend\Expressive\Application::ROUTING_MIDDLEWARE</code> and <code>DISPATCH_MIDDLEWARE</code> to
indicate the routing and dispatch middleware, as follows:</p>
<pre class=codehilite><code class=language-php>'middleware_pipeline' =&gt; [
    Application::ROUTING_MIDDLEWARE,
    Application::DISPATCH_MIDDLEWARE,
],</code></pre>
<p>In the above section, we detailed deprecation of the methods
<code>pipeRoutingMiddleware()</code> and <code>pipeDispatchMiddleware()</code>; the constants above
are the configuration equivalent of calling these methods, and are similarly
deprecated.</p>
<p>Change these entries to use the same syntax as other pipeline middleware, and
have the <code>middleware</code> key indicate the appropriate middleware class as follows:</p>
<pre class=codehilite><code class=language-php>'middleware_pipeline' =&gt; [
    [
        'middleware' =&gt; \Zend\Expressive\Router\Middleware\RouteMiddleware::class,
    ],
    [
        'middleware' =&gt; \Zend\Expressive\Router\Middleware\DispatchMiddleware::class,
    ],
],</code></pre>
<h2 id="implicit-head-and-options-middleware">Implicit HEAD and OPTIONS middleware</h2>
<p>These middleware have moved to the zend-expressive-router package. While they
still exist within the zend-expressive package, we have added deprecation
notices indicating their removal in v3. As such, update either of the following
statements, if they exist in your application:</p>
<pre class=codehilite><code class=language-php>$app-&gt;pipe(\Zend\Expressive\Middleware\ImplicitHeadMiddleware::class);
$app-&gt;pipe(\Zend\Expressive\Middleware\ImplicitOptionsMiddleware::class);</code></pre>
<p>to:</p>
<pre class=codehilite><code class=language-php>$app-&gt;pipe(\Zend\Expressive\Router\Middleware\ImplicitHeadMiddleware::class);
$app-&gt;pipe(\Zend\Expressive\Router\Middleware\ImplicitOptionsMiddleware::class);</code></pre>
<blockquote>
<p>The command <code>./vendor/bin/expressive migrate:expressive-v2.2</code> will do this for
you.</p>
</blockquote>
<h2 id="response-prototypes">Response prototypes</h2>
<p>A number of services expect a <em>response prototype</em> which will be used in order
to generate and return a response. Previously, we did not expose a service for
this, and instead hard-coded factories to create a zend-diactoros <code>Response</code>
instance when creating a service.</p>
<p>In version 3, we plan to instead compose a <em>response factory</em> in such services.
This is done to ensure a unique response prototype instance is generated for
each use; this is particularly important if you wish to use such services with
async web servers such as Swoole, ReactPHP, AMP, etc.</p>
<p>To prepare for that, Expressive 2.2 does the following:</p>
<ul>
<li>
<p>Creates <code>Zend\Expressive\Container\ResponseFactoryFactory</code>, and maps it to the
  service name <code>Psr\Http\Response\ResponseInterface</code>. It returns a <em>callable</em>
  that will generate a zend-diactoros <code>Response</code> instance each time it is
  called.</p>
</li>
<li>
<p>Creates <code>Zend\Expressive\Container\StreamFactoryFactory</code>, and maps it to the
  service name <code>Psr\Http\Response\StreamInterface</code>. It returns a <em>callable</em>
  that will generate a zend-diactoros <code>Stream</code> instance (backed by a read/write
  <code>php://temp</code> stream) each time it is called.</p>
</li>
</ul>
<p>The various factories that hard-coded generation of a response previously now
pull the <code>ResponseInterface</code> service and, if it is callable, call it to produce
a response, but otherwise use the return value.</p>
<p>This change should not affect most applications, <em>unless they were defining a
<code>ResponseInterface</code> service previously</em>. In such cases, ensure your factory
mapping has precedence by placing it in a <code>config/autoload/</code> configuration file.</p>
<h2 id="double-pass-middleware">Double-Pass middleware</h2>
<p><em>Double-pass middleware</em> refers to middleware that has the following signature:</p>
<pre class=codehilite><code class=language-php>function (
    ServerReqeustInterface $request,
    ResponseInterface $response,
    callable $next
) : ResponseInterface</code></pre>
<p>where <code>$next</code> will receive <em>both</em> a request <em>and</em> a response instance (this
latter is the origin of the "double-pass" phrasing).</p>
<p>Such middleware was used in v1 releases of Expressive, and we have continued to
support it through v2. However, starting in v3, we will no longer allow you to
directly pipe or route such middleware.</p>
<p>If you need to continue using such middleware, you will need to decorate it
using <code>Zend\Stratigility\Middleware\DoublePassMiddlewareDecorator()</code>. This
decorator class accepts the middleware and a response prototype as constructor
arguments, and decorates it to be used as http-interop middleware. (In version
3, it will decorate it as PSR-15 middleware.)</p>
<p>The zend-stratigility package provides a convenience function,
<code>Zend\Stratigility\doublePassMiddleware()</code>, to simplify this for you:</p>
<pre class=codehilite><code class=language-php>use Zend\Diactoros\Response;
use function Zend\Stratigility\doublePassMiddleware;

// Piping:
$app-&gt;pipe(doublePassMiddleware($someMiddleware, new Response()));

// Routing:
$app-&gt;get('/foo', doublePassMiddleware($someMiddleware, new Response()));</code></pre>
<h2 id="other-deprecations">Other deprecations</h2>
<p>The following classes, traits, and instance methods were deprecated, and will be
removed in version 3:</p>
<ul>
<li>
<p><code>Zend\Expressive\AppFactory</code>: if you are using this, you will need to switch
  to direct usage of <code>Zend\Expressive\Application</code> or a
  <code>Zend\Stratigility\MiddlewarePipe</code> instance.</p>
</li>
<li>
<p><code>Zend\Expressive\Application</code>: deprecates the following methods:</p>
</li>
<li><code>pipeRoutingMiddleware()</code>: <a href="#routing-and-dispatch-middleware">see the section above</a></li>
<li><code>pipeDispatchMiddleware()</code>: <a href="#routing-and-dispatch-middleware">see the section above</a></li>
<li><code>getContainer()</code>: this method is removed in version 3; container access will only be via the bootstrap.</li>
<li><code>getDefaultDelegate()</code>: the concept of a default delegate is removed in version 3.</li>
<li><code>getEmitter()</code>: emitters move to a different collaborator in version 3.</li>
<li>
<p><code>injectPipelineFromConfig()</code> andd <code>injectRoutesFromConfig()</code> are methods
    defined by the <code>ApplicationConfigInjectionTrait</code>, which will be removed in
    version 3. See the section on the <a href="#applicationconfiginjectiondelegator">ApplicationConfigInjectionDelegator</a>
    for an alternate, forwards-compatible, approach.</p>
</li>
<li>
<p><code>Zend\Expressive\ApplicationConfigInjectionTrait</code>: if you are using it, it is
  marked internal, and deprecated; it will be removed in version 3.</p>
</li>
<li>
<p><code>Zend\Expressive\Container\NotFoundDelegateFactory</code>: the <code>NotFoundDelegate</code>
  will be renamed to <code>Zend\Expressive\Handler\NotFoundHandler</code> in version 3,
  making this factory obsolete.</p>
</li>
<li>
<p><code>Zend\Expressive\Delegate\NotFoundDelegate</code>: this class becomes
  <code>Zend\Expressive\Handler\NotFoundHandler</code> in v3, and the new class is added in
  version 2.2 as well.</p>
</li>
<li>
<p><code>Zend\Expressive\Emitter\EmitterStack</code>: the emitter concept is extracted from
  zend-diactoros to a new component, zend-httphandlerrunner. This latter
  component is used in version 3, and defines the <code>EmitterStack</code> class. Unless
  you are extending it or interacting with it directly, this change should not
  affect you; the <code>Zend\Diactoros\Response\EmitterInterface</code> service will be
  directed to the new class in that version.</p>
</li>
<li>
<p><code>Zend\Expressive\IsCallableInteropMiddlewareTrait</code>: if you are using it, it is
  marked internal, and deprecated; it will be removed in version 3.</p>
</li>
<li>
<p><code>Zend\Expressive\MarshalMiddlewareTrait</code>: if you are using it, it is marked
  internal, and deprecated; it will be removed in version 3.</p>
</li>
<li>
<p><code>Zend\Expressive\Middleware\DispatchMiddleware</code>: <a href="#routing-and-dispatch-middleware">see the section above</a>.</p>
</li>
<li>
<p><code>Zend\Expressive\Middleware\ImplicitHeadMiddleware</code>: <a href="#implicit-head-and-options-middleware">see the section above</a>.</p>
</li>
<li>
<p><code>Zend\Expressive\Middleware\ImplicitOptionsMiddleware</code>: <a href="#implicit-head-and-options-middleware">see the section above</a>.</p>
</li>
<li>
<p><code>Zend\Expressive\Middleware\NotFoundHandler</code>: this will be removed in version 3, where you can instead pipe <code>Zend\Expressive\Handler\NotFoundHandler</code> directly instead.</p>
</li>
<li>
<p><code>Zend\Expressive\Middleware\RouteMiddleware</code>: <a href="#routing-and-dispatch-middleware">see the section above</a>.</p>
</li>
</ul>
<h2 id="applicationconfiginjectiondelegator">ApplicationConfigInjectionDelegator</h2>
<p>In addition to the above deprecations, we also provide a new class,
<code>Zend\Expressive\Container\ApplicationConfigInjectionDelegator</code>. This class
services two purposes:</p>
<ul>
<li>It can act as a <a href="../../features/container/delegator-factories/">delegator factory</a>
  for the <code>Zend\Expressive\Application</code> service; when enabled, it will
  look for <code>middleware_pipeline</code> and <code>routes</code> configuration, and use them to
  inject the <code>Application</code> instance before returning it.</li>
<li>It defines static methods for injecting pipelines and routes to an
  <code>Application</code> instance.</li>
</ul>
<p>To enable the delegator as a delegator factory, add the following configuration
to a <code>config/autoload/</code> configuration file, or a configuration provider class:</p>
<pre class=codehilite><code class=language-php>'dependencies' =&gt; [
    'delegators' =&gt; [
        \Zend\Expressive\Application::class =&gt; [
            \Zend\Expressive\Container\ApplicationConfigInjectionDelegator::class,
        ],
    ],
],</code></pre>
<p>To manually inject an <code>Application</code> instance, you can do the following:</p>
<pre class=codehilite><code class=language-php>use Zend\Expressive\Container\ApplicationConfigInjectionDelegator;

// assuming $config is the application configuration:
ApplicationConfigInjectionDelegator::injectPipelineFromConfig($app, $config);
ApplicationConfigInjectionDelegator::injectRoutesFromConfig($app, $config);</code></pre>
<p>These changes will be forwards-compatible with version 3.</p>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../migration/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../../../v1/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>




    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/zendframework/zend-expressive/edit/master/docs/book/v2/reference/migration-to-v2-2.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            <!-- content:end -->
            </div>
            <div class="col-md-3 col-xs-12 sidebar">
                
                    <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../../..">Expressive</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                
            

                
                
                    
                        
    <li class="subnavigation__list-item ">
        <a href="../../" class="subnavigation__link">Expressive: PSR-7 Middleware in Minutes</a>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Getting Started</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/features/" class="subnavigation__link">Overview and Features</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/standalone/" class="subnavigation__link">Quick Start: Standalone</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../getting-started/skeleton/" class="subnavigation__link">Quick Start: Skeleton Installer</a>
    </li>

            
        </ul>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Features</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/middleware-types/" class="subnavigation__link">Middleware Types</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/application/" class="subnavigation__link">Applications</a>
    </li>

            
                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Containers</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/container/intro/" class="subnavigation__link">Introduction</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/container/factories/" class="subnavigation__link">Container Factories</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/container/delegator-factories/" class="subnavigation__link">Delegator Factories</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/container/zend-servicemanager/" class="subnavigation__link">Using zend-servicemanager</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/container/pimple/" class="subnavigation__link">Using Pimple</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/container/aura-di/" class="subnavigation__link">Using Aura.Di</a>
    </li>

            
        </ul>
    </li>

            
                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Routing Adapters</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/intro/" class="subnavigation__link">Introduction</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/interface/" class="subnavigation__link">Routing Interface</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/uri-generation/" class="subnavigation__link">URI Generation</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/piping/" class="subnavigation__link">Routing vs Piping</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/aura/" class="subnavigation__link">Using Aura</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/fast-route/" class="subnavigation__link">Using FastRoute</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/router/zf2/" class="subnavigation__link">Using the ZF2 Router</a>
    </li>

            
        </ul>
    </li>

            
                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Templating</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/template/intro/" class="subnavigation__link">Introduction</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/template/interface/" class="subnavigation__link">Template Renderer Interface</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/template/middleware/" class="subnavigation__link">Templated Middleware</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/template/plates/" class="subnavigation__link">Using Plates</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/template/twig/" class="subnavigation__link">Using Twig</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/template/zend-view/" class="subnavigation__link">Using zend-view</a>
    </li>

            
        </ul>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/error-handling/" class="subnavigation__link">Error Handling</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/modular-applications/" class="subnavigation__link">Modular Applications</a>
    </li>

            
                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Middleware</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/middleware/implicit-methods-middleware/" class="subnavigation__link">Implicit HEAD and OPTIONS Middleware</a>
    </li>

            
        </ul>
    </li>

            
                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Helpers</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/helpers/intro/" class="subnavigation__link">Introduction</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/helpers/url-helper/" class="subnavigation__link">UrlHelper</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/helpers/server-url-helper/" class="subnavigation__link">ServerUrlHelper</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/helpers/body-parse/" class="subnavigation__link">Body Parsing Middleware</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/helpers/content-length/" class="subnavigation__link">Content-Length Middleware</a>
    </li>

            
        </ul>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../features/emitters/" class="subnavigation__link">Emitters</a>
    </li>

            
        </ul>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Cookbook</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/autowiring-routes-and-pipelines/" class="subnavigation__link">Autowiring routes and pipeline middleware</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/common-prefix-for-routes/" class="subnavigation__link">Prepending a common path to all routes</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/route-specific-pipeline/" class="subnavigation__link">Route-specific middleware pipelines</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/using-custom-view-helpers/" class="subnavigation__link">Registering custom view helpers when using zend-view</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/using-zend-form-view-helpers/" class="subnavigation__link">Using zend-form view helpers</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/using-a-base-path/" class="subnavigation__link">Using Expressive from a subdirectory</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/setting-locale-depending-routing-parameter/" class="subnavigation__link">Setting a locale based on a routing parameter</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/setting-locale-without-routing-parameter/" class="subnavigation__link">Setting a locale without a routing parameter</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/debug-toolbars/" class="subnavigation__link">Enabling debug toolbars</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/using-routed-middleware-class-as-controller/" class="subnavigation__link">Handling multiple routes in a single class</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/flash-messengers/" class="subnavigation__link">Flash Messengers</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../../cookbook/passing-data-between-middleware/" class="subnavigation__link">Passing data between middleware</a>
    </li>

            
        </ul>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Reference</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../../why-expressive/" class="subnavigation__link">Why choose Expressive?</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../cli-tooling/" class="subnavigation__link">CLI Tooling</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../usage-examples/" class="subnavigation__link">Examples</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../expressive-projects/" class="subnavigation__link">Expressive Projects</a>
    </li>

            
                
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Migration</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../migration/" class="subnavigation__link">To version 2</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">To version 2.2</a>
    </li>

            
        </ul>
    </li>

            
        </ul>
    </li>

                    
                
            

                
                

                    
                    
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>&copy; 2006-2019 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.zendframework.com" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://zendframework-slack.herokuapp.com" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://tinyletter.com/mwopzend" class="support__link" title="Newsletter"><i class="fa fa-envelope"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://framework.zend.com/blog/feed-rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://framework.zend.com/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script>
        var base_url = '../../..',
            siteName = 'Expressive';
    </script>
    <script src="../../../js/scripts-8d7ae56abf.js"></script>
        <script src="../../../search/main.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>



</body>


</html>
